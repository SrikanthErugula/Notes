
first manual ga one server crate chesi 
andhulu ansible ni install cheyali and aws configure ni set up cheyali --> git clone --> cd ansible-robo-roles 
--> ansible-playbook -i inventory 01-ec2-r53.yaml -e "instances=['mongodb','redis','mysql','rabbitmq','catalogue','user','cart','shipping','payment','frontend']"
--> pip3.9 install boto3 botocore

--> upto here session 26 lo setup chesam ippdu run chestunam 
ansible-playbook -i inventory.ini all-start-code.yaml -e "component=mongodb"
ansible-playbook -i inventory.ini all-start-code.yaml -e "component=redis"
ansible-playbook -i inventory.ini all-start-code.yaml -e "component=mysql"
ansible-playbook -i inventory.ini all-start-code.yaml -e "component=rabbitmq"   ----> one by one will run here 


CATALOGUE SET UP
====================
ansible-playbook -i inventory.ini all-start-code.yaml -e "component=catalogue"

--> cata lo common code chala vundi like as below  so we need to set common folder crated
app setup -->nodejs setup --> system --> remove and add user and folders ivvani common for all

--> in roles folder--> catalogue directory --> tasks folder --> main.yaml inside that for-common lo code nicall chstunam 

--> common folder --> tasks --> app-setup.yaml
--> common folder --> tasks --> nodejs.yaml

catalogue is one role, common is another role
catalogue should import the tasks in common role --> common folder nuchi techhukunttadhi 

--> here as per prod and dev ni base chesukoni below variable change avuuthun vunttadhi, so to over come this problem we need to create a separate folder in tasks
mongodb-dev.daws86s.fun  --> based on dev
mongodb-qa.daws86s.fun --> based on prod
mongodb.daws86s.fun  -> --> based on testing 

--> in roles --> catalogue --> vars folder created --> main.yaml

--> in roles documentation lo vars and defaults/  ani 2 vutai bur vars lo vunde vatiki high preference
--> so ila enni vars ayina call cheyachhu

--> in roles --> catalogue --> files created --> mongo.repo created 

when there is a change in service file /etc/systemd/system/{{ component }}.service"    something  notify others to reload

if any changes are done in code we have to perform notifiers or handlers  

--> roles --> catalogue --> handlers --> main.yaml

in interview --> What are the handlers 
===========
see in FINAL notes at last in this page 

--> catalogue.service file lo change chese value vundi that is mongodb.fun so we have to replace it in vars lo main.yaml file lo value HOST value

template
==========
fixed form with placeholders

--> we have jinja2 templating

--> in roles --> catalogue --> templates --> catalogue.service.j2
here j2 anedhi not manadatory but evaraina chusinappudu idhi roles template ani ardham avuthundhi
--> so andhulo some placeholders change cheyali ani ardham avuthundhi

What is template --: see in FINAL notes at last in this page 

-->so final ga catalogue ni run ayyi excute avuthundi done here 
--> so ansible content ni kuda check chestundi not a files 

--> for checking $ curl http://catalogue.dsoaws.fun:8080/health


so roles lo vars,tasks,templates,files,handlers, inka vunnai avi anni kuda use for custum  ga cheyalante like defaults/  meta/ library/  module_utils/ lookup_plugins  

--> here meta ante depended file means we can keep the role depended files --> evaraina chusina vallaki kuda ardham avuthuni

EX means catalogue anedi main ga for-common folder meedha run avuthundhi so see below

--> roles --> catalogue --> meta --> main.yaml 


USER SET UP
====================
ansible-playbook -i inventory.ini main.yaml -e "component=user"

in roles --> user dir

in user dir --> handlers --> main.yaml
   user dir --> meta --> main.yaml
   user dir --> vars -->main.yaml
  user dir --> tasks --> main.yaml
  user dir --> templates --> user.service.j2 *** j2 ani ivvakapothe error vastundhi 

in roles --> group_vars --> for-all.yaml ( indhulo all ki use ayye vatini ikkada store chestaru) 

Environment=REDIS_URL='redis://{{ REDIS_HOST }}:6379'
Environment=MONGO_URL="mongodb://{{ MONGODB_HOST }}:27017/users"

the above values comes from group_vars lo for-all.yaml lo numchi

--> for checking $ curl http://user.dsoaws.fun:8080/health


CART SET UP
=============				========= ansible-playbook -i inventory.ini main.yaml -e "component=cart"
in roles --> cart dir

in cart dir --> handlers --> main.yaml
   cart dir --> meta --> main.yaml
   cart dir --> vars -->main.yaml
  cart dir --> tasks --> main.yaml
  cart dir --> templates --> cart.service.j2 *** j2 ani ivvakapothe error vastundhi 

in roles --> group_vars --> for-all.yaml

Environment=CATALOGUE_HOST={{ CATALOGUE_HOST }} this values comes from group_vars lo for-all.yaml lo numchi


--> for checking $ curl http://cart.dsoaws.fun:8080/health

=================== SHIPPINH SET UP =============== ansible-playbook -i inventory.ini main.yaml -e "component=shipping"
so idhi konchem java set up then we need to create java.yaml see there

IN roles --> shipping dir

IN roles --> for-common --> java.yaml 

IN shiiping --> handlers (main.yaml) , --> meta (main.yaml) , --> tasks (main.yaml) , --> templates (shipping.service.j2)  , --> vars (main.yaml)

--> basically number of microservices might be increasing in project, then java ane microservice lo rayalante we can use this java.yaml 

Environment=CART_ENDPOINT={{ CART_HOST }}:8080
Environment=DB_HOST={{ MYSQL_HOST }} -------------------> comes from group_vars lo for-all.yaml lo numchi

    login_user: "{{ MYSQL_ROOT_USER }}"
    login_password: "{{ MYSQL_ROOT_PASSWORD }}  -------------> these values come from vars --> main.yaml file lo

-> for checking $ curl http://shipping.dsoaws.fun:8080/health

============================================= PAYMENT SET UP ==================== ansible-playbook -i inventory.ini main.yaml -e "component=payment" 

IN roles --> payment DIR

IN payment dir -->  handlers (main.yaml) , --> meta (main.yaml) , --> tasks (main.yaml) , --> templates (payment.service.j2)  , --> vars (main.yaml)

IN roles --> for-common --> python.yaml 


Environment=AMQP_USER={{ RABBITMQ_USER }}
Environment=AMQP_PASS={{ RABBITMQ_PASS }}  -------> these values come from vars --> main.yaml file lo

Environment=AMQP_HOST={{ RABBITMQ_HOST }}
Environment=USER_HOST={{ USER_HOST }}  ------------>comes from group_vars lo for-all.yaml lo numchi


-> for checking $ curl http://shipping.dsoaws.fun:8080/health

========================= FRONTEND SET UP ================== ansible-playbook -i inventory.ini main.yaml -e "component=frontend" 

IN roles --> frontend dir 

In frontend --> handlers (main.yaml) ,  --> tasks (main.yaml) , --> templates (payment.service.j2)

  src: nginx.conf.j2 --> its defined in templates folders bcz in future if any changes will happen it will automatically reflect once run code 

plugins kuda vunttai
https://docs.ansible.com/projects/ansible/latest/playbook_guide/playbooks_reuse_roles.html here all doc about roles======


====================================================== FINAl NOTES ===================


 
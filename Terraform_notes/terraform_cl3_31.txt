cd /c/Users/srika/devsecops/shellscript/Notes/Terraform_notes/

Variables:-
=============
variable "var_name" {
	default = "default_value"
}

--> SO inka varibales like as below laga kuda declare cheyachu

1. Through command line
2. terraform.tfvars
3. ENV variable TF_VAR_var_name
4. default value
5. prompt it means it is asking pls enter like that

var.var_name --> ila code lo variables ni declare cheyachu

"${var.var_name}" --> ila ekkuva vars ni declare cheyalante process like this

types of variables
================
number
string
list
map
bool

Condition:-
==============
expression ? "true" : "false"

loops
======
count based loop -> it is used to get list iteration, here aa process lo manaki count.index ani vastundi

count = number

count.index --> so ikkasa loop ayina everytime manaki ila oka special variables istundhi   ---------------> these all are learn by class 30 
=======================================================================================================

resource "aws_instance" "terraform" {} --> so ikkada ee block varaku output kavalante u need to ask like these ..so ala dhenikaina kuda we can get........

output "instances_output" 
{
#   value = aws_instance.terraform # so idhi ec2.tf lo name vuntthdi so akkada numchi tisukovali
# }
======			===========			==========				======
for loop --> we are using it, in set or map situation lo use chestam...

for_each = toset(["bucket-alpha", "bucket-beta", "bucket-gamma"])  --> so ikkada map ki matrame chestam, don't use it in at count 

list -> string values --> in this situation we need to use count-based
map -> key and values  --> in this situation we need to use for-loops

frontend = "ip-address" 
key       = " value "

This is EX: of map iteration
==============
---> so here while running iteration process entries execute like these below 
{

key = value  ---> so here we need to use word is each.......each.key = each.value .......idhi antha oka entry 
key2 = value2  --> and this one each ..each.key2 = each.value2  ------- idhi antha oka entry.... so ala

}
every entry is considered as each. each.key and each.value

---> so here each anedhi oka reserved key word terraform manaki ichhe key word 
=========		=========			==============		========		========
--> for-loop folder has been created in VSCODE

--> for_each ichham ante iteration start avuthundi.. and instace_type each.value vatundhi... and in ec2 tags lo name ki each.key vastudhi...these data comes from variable.tf

--->for_each = var.instances --> so here each key ichham and each value kuda ichham ... var.instance anedhi variable.tf file var_instances lo nunchi vastudhi
----> see in VSCODE output_check file for detailed info..
---> so map details levvu anukunte list deatails ni map loki convert cheyalante we need toset syntax appudu list nuchi map convert ayyi key = value avuthundhi

count -> list -> count.index
for_each -> map -> each.key and each.value

I want to iterate list through for_each

for_each = toset(list)

each.value

EX:
default = {
    #     mongodb = "t3.micro"
    #     redis = "t3.micro"
    #     mysql = "t3.small"
    # } 

--> so here everytime ila t3.micro ani pettakudanda dhani list laga [] pettukoni,,, map{} loki covert chesi for_each ni run cheste done


EX: 
---> default = {
    #     mongodb = {
    #         instance_type = "t3.micro"
    #         ami = "ami-id"
    #     }
    #     redis = "t3.micro"
    #     mysql = "t3.small"
    # }

----> so here manaki eppdu okela ami id vundadhu so alanti situation lo manki separate ga above laga rasukoni for_each ni run cheyachu

======================================================================= 	================	===============	================================	===================
data sources
==============
we are creating resources in provider( provider means ...aws, azure.. anything) 

---> sources means we can query the existing information in the provider using data sources.

---> so here amiid lu change avuthai when we were changed the information inside

---> resources means creating the instaces or servers

Syntax is: 
=========
data "aws_ami" "joindevops" {
	parameters to query
}


--> so here evaru ithe query chestaroo Valle owner avutharu ---> very IMP topic projects lo baga use chestaru ......

---> terraform data sources ami -> https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami

--> so here value = data.aws_ami.joindevops.id ---> here manaki dynamic ga ami id vastundhi oke vela change ayina kuda update ayyi manaki vastundi....

functions : it means take i/p and give o/p
============

--> More Examples on functions https://developer.hashicorp.com/terraform/language/functions/join 
see in left side we have function name u can open and see all the operations

EX: 
====
 max(5, 12, 9)
12  --> max is a type function here it was given max value in that function

--------> here u can use terraform console  ---> to check o/p 
EX:- on length function
=
 length(["sjhdjshd", "skdjisjdsij", "skdjisfsdfsfdsfjdsifs", "kdjisjd",":"])
5

EX on join functions
========================
join(" " ,[ " Srikanth" , "Erugula" ])
" Srikanth Erugula"

EX 2
-----
> join("_",["Srikanth","Reddy","Erugula"])
"Srikanth_Reddy_Erugula"


merge function

{
	a = b
	c = d
	x = y
},

{
	a = b
	c = e
}

--> so here we just assume the above 2 map are like 2 segments, then 2nd one segment is always ready to replace the values if it has assigned different....see the result as below
result
======
a = b
c = e
x = y

--->merge({a="b", c="d"}, {e="f", c="z"})

result:-
=====
a = b
c = z
e = f


state
=========
whatever we give in .tf files, it should create those resources -> declarative way of creating infra( so here manam cheptunam naaku idhi kavali ani rasi istunam) 
--> A "declarative way" means describing what you want as a result, not how to get it


matching you declared infra with actual infra in AWS account

state file -> terraform uses this file to track what it created  ---> so here state file lo first time run chesinappudu store chesukunttadhi and next time run chestunte create avvadhu

1. tf files -> expectation or desired or declared  ---> naaku idhi kavali ani ikkada cheptam
2. actual infra -> reality or existing ---> so ikkkada data ni chusukoni antha ok anukoni terraform will create the resources
3. state -> for comparision

first time
===============
no state file -> new or first time
created -> .tfstate  --> so here .tf file create cheste automatically adhi .tfstate create ayi store chesukunttadhi.....

2nd time
===============
aws_security_group.allow_all: Refreshing state... 2nd time checking will happening that is called refreshing...

--> so here it will compare actual infra vs state file

nothing to change  --> after checks all done we will get this msg like nothing to change....



manually delete in the console  --> here aws loki veli ec2 instance loki velli manual ga delete cheyatum that is manual delete
=================
refreshing state   ---> it means there is checking operation will happen in the ec2 instance status here

--> whatever in state file, it is exist in AWS account or not?

then someone outside of terraform did something....... evaro edho changes chesaru, then terraform need to re create again, that is terraform job
=====================================================================

I changed in tf files
====================
refreshing state --> terraform plan run cheste adi refresh avuthundi

state == actual infra  --> refresh ayyi tfstate tho comparison chesukoni both same ani cheptundi

desired infra != actual infra --> but here manaki idi kavali ani cheppi code rasam kani adi actual infra tho match avvatum ledhu, so then terraform plan run cheste desired code tho actual infra or code tho match chesukoni malli tfstate file change chesukoni akkda store chesukunttadhi... 


when I removed something
=====================
refreshing state

state == actual infra

desired infra != actual infra  --> user ec2 resource vadhu ni desired ga cheppadu, so appudu actual infra tho match avvaledhu so then terraform will delete the ec2 resources and update the tfstate file

deleted in actual infra
updated in state file

--> so ilanti tfstate option ansible lo ledhu kabatti it doesn't work or suitable for infra.... terraform has rights to manage the infra.....


What is terraform state
=====================
terraform state is used to match the desired infra with actual infra, when create read update and delete the infra terraform uses this state file to achieve the desired infra for comparison. It is like memory to terraform

---> terraform locks the state file when terraform is running......>it means terraform apply ni run chestunte, so there tfstate file ni terraform lock chestundi, evvaru kuda disturb cheyakunda.>   process anthe run tharvatha unlock chestundi..appudu manaki visible avuthundi..

